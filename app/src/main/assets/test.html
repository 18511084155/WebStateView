<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>书呆子精神院</title>
    <meta name="author" content="Yanyuetian">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1,  user-scalable=no">
    <meta property="og:site_name" content="书呆子精神院"/>
    <script src="file:///android_asset/zepto.js" type="text/javascript"></script>
    <style>
      .entry{
          -webkit-padding-start: 30px;
      }
      .entry li {
          line-height: 29px;
          margin-left: -10px;
      }
      .entry li div{
          margin-right: 10px;
          padding-left: 8px;
          padding-top: 8px;
          padding-bottom: 8px;
          background: #222222;
          color: white;
          word-break: break-all;
          -ms-word-wrap: break-word;
          word-wrap: break-word;
          line-height: 15px;
          font-size: 10pt;
      }
      .entry li button{
          margin-top: 5px;
          width: 60px;
          height: 35px;
          color: #111111;
      }

    </style>
</head>

<body>
<div class="blog-header">
    <h3>Java Interface 可用接口列表测试</h3>
</div>
<ul class="entry">
    <li>
        确认框弹出<br/>
        代码：<br/>
        <div>
            HostApp.alert('我是确认框');
        </div>
        <button onclick="HostApp.alert('我是确认框');">测试</button>
    </li>

    <br/>
    <li>
        气泡提示<br/>
        代码：<br/>
        <div>
            HostApp.toast('我是气泡');
        </div>
        <button onclick="HostApp.toast('我是气泡');">测试</button>
    </li>

    <br/>
    <li>
        测试代码执行时间<br/>
        代码：<br/>
        <div>
            HostApp.testLossTime(new Date().getTime());
        </div>
        <button onclick="HostApp.testLossTime(new Date().getTime());">测试</button>
    </li>

    <br/>
    <li>
        获得设备IMSI<br/>
        代码：<br/>
        <div>
            HostApp.alert(
            HostApp.getIMSI()
            );
        </div>
        <button onclick="HostApp.alert(HostApp.getIMSI());">测试</button>
    </li>

    <br/>
    <li>
        传入JSON对象,返回对象的一个键值字符串<br/>
        代码：<br/>
        <div>
            HostApp.alert(
            HostApp.passJson2Java({'key1': 'first-value', 'key2': 'secd-value'})
            );
        </div>
        <button onclick="HostApp.alert(HostApp.passJson2Java({'key1': 'first-value', 'key2': 'secd-value'}));">
            测试
        </button>
    </li>

    <br/>
    <li>
        传入JSON,返回相同的JSON对象<br/>
        代码：<br/>
        <div>
            HostApp.alert(
            JSON.stringify(HostApp.retBackPassJson({'b1': 'back-value1', 'b2': 'back-value2'}))
            );
        </div>
        <button onclick="HostApp.alert(JSON.stringify(HostApp.retBackPassJson({'b1': 'back-value1', 'b2': 'back-value2'})));">
            测试
        </button>
    </li>

    <br/>
    <li>
        异步回调，传入js函数到Java方法,设定3秒后回调<br/>
        代码：<br/>
        <div>
            HostApp.delayJsCallBack(3, 'call back haha', function (msg) {
            HostApp.alert(msg);
            });
        </div>
        <button onclick="HostApp.delayJsCallBack(3, 'call back haha', function (msg) {HostApp.alert(msg);});">
            测试
        </button>
    </li>

    <br/>
    <li>
        重载方法测试-执行整型定义<br/>
        代码：<br/>
        <div>
            HostApp.alert(
            HostApp.overloadMethod(1)
            );
        </div>
        <button onclick="HostApp.alert(HostApp.overloadMethod(1));">测试</button>
    </li>

    <br/>
    <li>
        重载方法测试-执行字符串定义<br/>
        代码：<br/>
        <div>
            HostApp.alert(
            HostApp.overloadMethod('12adadad')
            );
        </div>
        <button onclick="HostApp.alert(HostApp.overloadMethod('12adadad'));">测试</button>
    </li>

    <br/>
    <li>
        从Java层返回Java对象<br/>
        代码：<br/>
        <div>
            HostApp.alert(
            HostApp.retJavaObject()[0].intField
            );
        </div>
        <button onclick="HostApp.alert(HostApp.retJavaObject()[0].intField);">测试</button>
    </li>

    <br/>
    <li>
        过大数字精度丢失测试<br/>
        代码：<br/>
        <div>
            HostApp.alert(
            HostApp.passLongType(14102300951321235) + ''
            );
        </div>
        <button onclick="HostApp.alert(HostApp.passLongType(14102300951321235) + '');">测试</button>
    </li>
</ul>
<script>

(function () {
alert('123');
    function sendData(data) {
        window.xyqbNative.webViewAuthCollectionResults && window.xyqbNative.webViewAuthCollectionResults({
            'data': data, //采集到的授权信息
        })
    };

    function sendProgress(json) {
        window.xyqbNative.webViewAuthProgress && window.xyqbNative.webViewAuthProgress(json);
    };

    function isOverTime(time) {
        time = time.replace('年', '-').replace('月', '-').replace('日', '');
        var nowdate = new Date();
        nowdate.setMonth(nowdate.getMonth() - 9);
        var y = nowdate.getFullYear();
        var m = nowdate.getMonth() + 1;
        m = m >= 10 ? m : '0' + m;
        var d = nowdate.getDate();
        d = d >= 10 ? d : '0' + d;
        var formatwdate = y + '-' + m + '-' + d;
        return new Date(time).getTime() < new Date(formatwdate).getTime()
    }

    var urllList01 = ['https://member1.taobao.com/member/fresh/account_profile.htm', 'https://i.taobao.com/my_taobao.htm', 'https://member1.taobao.com/member/fresh/deliver_address.htm', 'https://pages.tmall.com/wow/jifen/act/point-details', 'https://buyertrade.taobao.com/trade/itemlist/list_bought_items.htm'];
    var locationUrl01 = window.location.href;
    var urlIndex01 = urllList01.indexOf(locationUrl01);
    switch (urlIndex01) {
        case 0:
            var trueName = '';
            try {
                trueName = document.querySelector('.elem-form > li:nth-child(1) > strong').innerText;
                sendData({ type: 1, username: trueName });
                sendProgress({ progress: 10 });
                if (urlIndex01 > -1 && urlIndex01 < urllList01.length - 1) {
                    window.location.href = urllList01[urlIndex01 + 1];
                }
            } catch (error) {
                window.xyqbNative.webViewAuthFailure && window.xyqbNative.webViewAuthFailure()
            }
            break;
        case 1:
            try {
                document.getElementById('J_MyAlipayInfo').dispatchEvent(new Event('mouseover'))
                var timer = setInterval(() => {
                    try {
                        var box = document.querySelector('.i-dropdown-con');
                        var allowCountDom = box.querySelector('#J_MyAlipayInfo > div > div > div > ul > li:nth-child(3) > span.hidden.J_HuaBeiMoney > em');
                        if (allowCountDom) {
                            clearInterval(timer);
                            var allowCount = allowCountDom.innerText;
                            var totalCount = box.querySelector('#J_MyAlipayInfo > div > div > div > ul > li:nth-child(3) > p.mFund-profit.J_HuaBeiMoney > span').innerText;
                            var resObj = {
                                type: 2,
                                allowCount,
                                totalCount
                            };
                            sendData(resObj);
                            sendProgress({ progress: 20 });
                            if (urlIndex01 > -1 && urlIndex01 < urllList01.length - 1) {
                                window.location.href = urllList01[urlIndex01 + 1];
                            }
                        }
                    } catch (error) {
                        window.xyqbNative.webViewAuthFailure && window.xyqbNative.webViewAuthFailure()
                    }
                }, 100)
            } catch (error) {
                window.xyqbNative.webViewAuthFailure && window.xyqbNative.webViewAuthFailure()
            }
            break;
        case 2:
            try {
                var addressListDom = document.querySelectorAll('.thead-tbl-address');
                var addressList = [];
                for (var i = 0; i < addressListDom.length; i++) {
                    var hh = addressListDom[i].querySelectorAll('td');
                    var obj = {
                        receiver: hh[0].innerText,
                        areaDetail: hh[1].innerText,
                        addressDetail: hh[2].innerText,
                        zipCode: hh[3].innerText,
                        phone: hh[4].innerText.replace(/s+/g, ''),
                        isDefault: hh[6].querySelector('span') ? true : false
                    }
                    addressList.push(obj)
                }
                sendData({ type: 3, addressList });
                sendProgress({ progress: 40 });
                if (urlIndex01 > -1 && urlIndex01 < urllList01.length - 1) {
                    window.location.href = urllList01[urlIndex01 + 1];
                }
            } catch (error) {
                window.xyqbNative.webViewAuthFailure && window.xyqbNative.webViewAuthFailure()
            }
            break;
        case 3:
            alert('111');
            window.xyqbNative.webViewAuthSetUserAgent && window.xyqbNative.webViewAuthSetUserAgent({ userAgent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36' })
            alert('2222')
            var integral = {};
            var pageIndex = 1;
            var isOver = false;
            integral.totalScore = document.querySelector('#J_pointSummary > div > div.item.valid > span.point').innerText;
            integral.items = [];
            integral.type = 4;
            function getIntegralData() {
                pageIndex++;
                var itemList = document.querySelectorAll('.item-list li');
                for (var i = 0; i < itemList.length; i++) {
                    var obj = {};
                    obj.id = itemList[i].querySelector('div.why > span').innerText;
                    obj.source = itemList[i].querySelector('div.why > a.title').innerText;
                    obj.scoreChange = itemList[i].querySelector('div.what > span').innerText;
                    obj.createTime = itemList[i].querySelector('div.when').innerText;
                    isOver = isOverTime(obj.createTime);
                    if (isOver) {
                        break;
                    }
                    obj.mark = itemList[i].querySelector('div.notes').innerText;
                    integral.items.push(obj);
                }
                var pageN = document.querySelector('#J_pointPager > div > div > div.mui-page-num > a.mui-page-next');
                if (!isOver && pageN) {
                    pageN.click();
                    var timer = setInterval(() => {
                        var pi = document.querySelector('#J_pointPager > div > div > div.mui-page-num > b.mui-page-cur').innerText == pageIndex;
                        if (pi) {
                            clearInterval(timer);
                            getIntegralData();
                        }
                    }, 100)
                } else {
                    sendData(integral);
                    sendProgress({ progress: 70 });
                }

            }
            try {
                getIntegralData();
            } catch (error) {
                window.xyqbNative.webViewAuthFailure && window.xyqbNative.webViewAuthFailure()
            }
            break;
        case 4:
            var goosList = [];
            var pageIndex = 1;
            var isOver = false;
            var isLoad = false;
            function selectData() {
                pageIndex++;
                var tableList = document.querySelectorAll('.js-order-container table');
                for (var i = 0; i < tableList.length; i++) {
                    var obj = {};
                    var tbody = tableList[i].querySelectorAll('tbody tr');
                    var length = tbody.length;
                    obj.createTime = tbody[0].querySelector('.bought-wrapper-mod__create-time___yNWVS').innerText.replace(/s+/g, '')
                    isOver = isOverTime(obj.createTime);
                    if (isOver) {
                        break;
                    }
                    obj.id = tbody[0].querySelector('td.bought-wrapper-mod__head-info-cell___29cDO > span > span:nth-child(3)').innerText;
                    obj.totalMoney = tbody[1].querySelector('div.price-mod__price___157jz > p > strong > span:nth-child(2)').innerText;
                    obj.status = tbody[1].querySelector('td:nth-child(6) > div > p > span').innerText;
                    obj.goods = [];
                    obj.goods.push({
                        name: tbody[1].querySelector('td:nth-child(1) > div > div:nth-child(2) > p:nth-child(1) > a:nth-child(1) > span:nth-child(2)') ? tbody[1].querySelector('td:nth-child(1) > div > div:nth-child(2) > p:nth-child(1) > a:nth-child(1) > span:nth-child(2)').innerText : tbody[1].querySelector('td:nth-child(1) > div > div:nth-child(2) > p:nth-child(1) > span:nth-child(1) > span:nth-child(2)').innerText,
                        count: tbody[1].querySelector('td:nth-child(3) > div > p').innerText,
                        price: tbody[1].querySelector('td:nth-child(2) > div > p:nth-child(2) > span:nth-child(2)') ? tbody[1].querySelector('td:nth-child(2) > div > p:nth-child(2) > span:nth-child(2)').innerText : tbody[1].querySelector('td:nth-child(2) > div > p > span:nth-child(2)').innerText
                    })
                    for (var j = 2; j < length - 1; j++) {
                        obj.goods.push({
                            name: tbody[j].querySelector('td:nth-child(1) > div > div:nth-child(2) > p:nth-child(1) > a:nth-child(1) > span:nth-child(2)').innerText,
                            count: tbody[j].querySelector('td:nth-child(3) > div > p').innerText,
                            price: tbody[1].querySelector('td:nth-child(2) > div > p:nth-child(2) > span:nth-child(2)') ? tbody[1].querySelector('td:nth-child(2) > div > p:nth-child(2) > span:nth-child(2)').innerText : tbody[1].querySelector('td:nth-child(2) > div > p > span:nth-child(2)').innerText
                        })
                    }
                    goosList.push(obj);
                }
                var pageNext = document.querySelector('#tp-bought-root > div.row-mod__row___30Zj1.js-actions-row-bottom > div:nth-child(2) > ul > li.pagination-item.pagination-item-' + pageIndex);
                if (!isOver && pageNext) {
                    pageNext.click();
                    var timer = setInterval(() => {
                        var pi = document.querySelector('.pagination-item-active > a').innerText == pageIndex;
                        if (pi) {
                            clearInterval(timer);
                            selectData();
                        }
                    }, 100)
                } else {
                    if (isLoad) return
                    isLoad = true;
                    sendData({ type: 5, goosList });
                    sendProgress({ progress: 100 });
                    if (urlIndex01 > -1 && urlIndex01 < urllList01.length - 1) {
                        window.location.href = urllList01[urlIndex01 + 1];
                    }
                }
            }
            try {
                selectData();
            } catch (error) {
                window.xyqbNative.webViewAuthFailure && window.xyqbNative.webViewAuthFailure()
            }
            break;
    }
})();;

</script>
</body>
</html>
