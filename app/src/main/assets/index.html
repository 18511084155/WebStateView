<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
    #btn {
        height: 200px;
        width: 200px;
        background: red;
    }
    </style>
</head>

<body>
    <button id="btn">
        点击授权淘宝
    </button>
    <script>
    document.getElementById('btn').onclick = function() {
        window.xyqbNative.webViewAuth && window.xyqbNative.webViewAuth({
            "type": "TAOBAO",
            "url": "https://login.m.taobao.com/login.htm?tpl_redirect_url=https%3a%2f%2fmember1.taobao.com%2fmember%2ffresh%2faccount_profile.htm", // 页面地址
            "javascriptCode": `(function () {
    function sendData(data) {
        window.xyqbNative.webViewAuthCollectionResults && window.xyqbNative.webViewAuthCollectionResults({
            'data': data
        });
    };

    function sendProgress(json) {
        window.xyqbNative.webViewAuthProgress && window.xyqbNative.webViewAuthProgress(json);
    };

    function isOverTime(time) {
        time = time.replace('年', '-').replace('月', '-').replace('日', '');
        var nowdate = new Date();
        nowdate.setMonth(nowdate.getMonth() - 9);
        var y = nowdate.getFullYear();
        var m = nowdate.getMonth() + 1;
        m = m >= 10 ? m : '0' + m;
        var d = nowdate.getDate();
        d = d >= 10 ? d : '0' + d;
        var formatwdate = y + '-' + m + '-' + d;
        return new Date(time).getTime() < new Date(formatwdate).getTime();
    };
    var urllList01 = ['https://member1.taobao.com/member/fresh/account_profile.htm', 'https://i.taobao.com/my_taobao.htm', 'https://member1.taobao.com/member/fresh/deliver_address.htm', 'https://pages.tmall.com/wow/jifen/act/point-details', 'https://buyertrade.taobao.com/trade/itemlist/list_bought_items.htm','http://localhost'];
    var locationUrl01 = window.location.href;
    var urlIndex01 = urllList01.indexOf(locationUrl01);
    switch (urlIndex01) {
        case 0:
            sendProgress({ progress: 1 });
            var trueName = '';
            try {
                trueName = document.querySelector('.elem-form > li:nth-child(1) > strong').innerText;
                sendProgress({ progress: 10 });
                sendData({ type: 1, username: trueName });
                if (urlIndex01 > -1 && urlIndex01 < urllList01.length - 1) {
                    window.location.href = urllList01[urlIndex01 + 1];
                }
            } catch (error) {
                window.xyqbNative.webViewAuthFailure && window.xyqbNative.webViewAuthFailure();
            }
            break;
        case 1:
            try {
                document.getElementById('J_MyAlipayInfo').dispatchEvent(new Event('mouseover'));
                var timer = setInterval(() => {
                    try {
                        var box = document.querySelector('.i-dropdown-con');
                        var allowCountDom = box.querySelector('#J_MyAlipayInfo > div > div > div > ul > li:nth-child(3) > span.hidden.J_HuaBeiMoney > em');
                        if (allowCountDom) {
                            clearInterval(timer);
                            var allowCount = allowCountDom.innerText;
                            var totalCount = box.querySelector('#J_MyAlipayInfo > div > div > div > ul > li:nth-child(3) > p.mFund-profit.J_HuaBeiMoney > span').innerText;
                            var resObj = {
                                type: 2,
                                allowCount,
                                totalCount
                            };
                            sendProgress({ progress: 20 });
                            sendData(resObj);
                            if (urlIndex01 > -1 && urlIndex01 < urllList01.length - 1) {
                                window.location.href = urllList01[urlIndex01 + 1];
                            }
                        }
                    } catch (error) {
                        window.xyqbNative.webViewAuthFailure && window.xyqbNative.webViewAuthFailure();
                    }
                }, 100);
            } catch (error) {
                window.xyqbNative.webViewAuthFailure && window.xyqbNative.webViewAuthFailure();
            }
            break;
        case 2:
            try {
                var addressListDom = document.querySelectorAll('.thead-tbl-address');
                var addressList = [];
                for (var i = 0; i < addressListDom.length; i++) {
                    var hh = addressListDom[i].querySelectorAll('td');
                    var obj = {
                        receiver: hh[0].innerText,
                        areaDetail: hh[1].innerText,
                        addressDetail: hh[2].innerText,
                        zipCode: hh[3].innerText,
                        phone: hh[4].innerText.replace(/s+/g, ''),
                        isDefault: hh[6].querySelector('span') ? true : false
                    };
                    addressList.push(obj);
                }
                sendProgress({ progress: 40 });
                sendData({ type: 3, addressList });
                window.xyqbNative.webViewAuthSetUserAgent && window.xyqbNative.webViewAuthSetUserAgent({ userAgent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36', url: 'https://pages.tmall.com/wow/jifen/act/point-details' });
            } catch (error) {
                window.xyqbNative.webViewAuthFailure && window.xyqbNative.webViewAuthFailure();
            }
            break;
        case 3:
             try {
                var integral = {};
                var pageIndex = 1;
                var isOver = false;
                integral.totalScore = document.querySelector('#J_pointSummary > div > div.item.valid > span.point').innerText;
                integral.items = [];
                integral.type = 4;
                function getIntegralData() {
                    pageIndex++;
                    var itemList = document.querySelectorAll('.item-list li');
                    for (var i = 0; i < itemList.length; i++) {
                        var obj = {};
                        obj.id = itemList[i].querySelector('div.why > span').innerText;
                        obj.source = itemList[i].querySelector('div.why > a.title').innerText;
                        obj.scoreChange = itemList[i].querySelector('div.what > span').innerText;
                        obj.createTime = itemList[i].querySelector('div.when').innerText;
                        isOver = isOverTime(obj.createTime);
                        if (isOver) {
                            break;
                        }
                        obj.mark = itemList[i].querySelector('div.notes').innerText;
                        integral.items.push(obj);
                    }
                    var pageN = document.querySelector('#J_pointPager > div > div > div.mui-page-num > a.mui-page-next');
                    if (!isOver && pageN) {
                        pageN.click();
                        var timer = setInterval(() => {
                            try {
                                var pi = document.querySelector('#J_pointPager > div > div > div.mui-page-num > b.mui-page-cur').innerText == pageIndex;
                                if (pi) {
                                    clearInterval(timer);
                                    getIntegralData();
                                }
                            } catch (error) {
                                window.xyqbNative.webViewAuthFailure && window.xyqbNative.webViewAuthFailure();
                            }
                        }, 100);
                    } else {
                        sendProgress({ progress: 70 });
                        sendData(integral);
                        window.xyqbNative.webViewAuthSetUserAgent && window.xyqbNative.webViewAuthSetUserAgent({ userAgent: '', url: 'https://buyertrade.taobao.com/trade/itemlist/list_bought_items.htm' });
                    }

                }
                getIntegralData();
            } catch (error) {
                window.xyqbNative.webViewAuthFailure && window.xyqbNative.webViewAuthFailure();
            }
            break;
        case 4:
            try {
                var goosList = [];
                var pageIndex = 1;
                var isOver = false;
                var isLoad = false;
                function selectData() {
                    pageIndex++;
                    var tableList = document.querySelectorAll('.js-order-container table');
                    for (var i = 0; i < tableList.length; i++) {
                        var obj = {};
                        var tbody = tableList[i].querySelectorAll('tbody tr');
                        var length = tbody.length;
                        obj.createTime = tbody[0].querySelector('.bought-wrapper-mod__create-time___yNWVS').innerText.replace(/s+/g, '');
                        isOver = isOverTime(obj.createTime);
                        if (isOver) {
                            break;
                        }
                        obj.id = tbody[0].querySelector('td.bought-wrapper-mod__head-info-cell___29cDO > span > span:nth-child(3)').innerText;
                        obj.totalMoney = tbody[1].querySelector('div.price-mod__price___157jz > p > strong > span:nth-child(2)').innerText;
                        obj.status = tbody[1].querySelector('td:nth-child(6) > div > p > span').innerText;
                        obj.goods = [];
                        obj.goods.push({
                            name: tbody[1].querySelector('td:nth-child(1) > div > div:nth-child(2) > p:nth-child(1) > a:nth-child(1) > span:nth-child(2)') ? tbody[1].querySelector('td:nth-child(1) > div > div:nth-child(2) > p:nth-child(1) > a:nth-child(1) > span:nth-child(2)').innerText : tbody[1].querySelector('td:nth-child(1) > div > div:nth-child(2) > p:nth-child(1) > span:nth-child(1) > span:nth-child(2)').innerText,
                            count: tbody[1].querySelector('td:nth-child(3) > div > p').innerText,
                            price: tbody[1].querySelector('td:nth-child(2) > div > p:nth-child(2) > span:nth-child(2)') ? tbody[1].querySelector('td:nth-child(2) > div > p:nth-child(2) > span:nth-child(2)').innerText : tbody[1].querySelector('td:nth-child(2) > div > p > span:nth-child(2)').innerText
                        });
                        for (var j = 2; j < length - 1; j++) {
                            obj.goods.push({
                                name: tbody[j].querySelector('td:nth-child(1) > div > div:nth-child(2) > p:nth-child(1) > a:nth-child(1) > span:nth-child(2)').innerText,
                                count: tbody[j].querySelector('td:nth-child(3) > div > p').innerText,
                                price: tbody[1].querySelector('td:nth-child(2) > div > p:nth-child(2) > span:nth-child(2)') ? tbody[1].querySelector('td:nth-child(2) > div > p:nth-child(2) > span:nth-child(2)').innerText : tbody[1].querySelector('td:nth-child(2) > div > p > span:nth-child(2)').innerText
                            });
                        }
                        goosList.push(obj);
                    }
                    var pageNext = document.querySelector('#tp-bought-root > div.row-mod__row___30Zj1.js-actions-row-bottom > div:nth-child(2) > ul > li.pagination-item.pagination-item-' + pageIndex);
                    if (!isOver && pageNext) {
                        pageNext.click();
                        var timer = setInterval(() => {
                            try {
                                var pi = document.querySelector('.pagination-item-active > a').innerText == pageIndex;
                                if (pi) {
                                    clearInterval(timer);
                                    selectData();
                                }
                            } catch (error) {
                                window.xyqbNative.webViewAuthFailure && window.xyqbNative.webViewAuthFailure();
                            }
                        }, 100);
                    } else {
                        if (isLoad) return;
                        isLoad = true;
                        sendProgress({ progress: 100 });
                        sendData({ type: 5, goosList });
                    }
                }
                selectData();
            } catch (error) {
                window.xyqbNative.webViewAuthFailure && window.xyqbNative.webViewAuthFailure();
            }
            break;
    }
})();
  `,
            "userAgent": ""
        })
    }
    </script>
</body>

</html>